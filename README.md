# 易行地图

**经过了这漫长的十天，今天就这样到了ddl，我还没做完（×）**

**易行地图是基于高德地图SDK完成的软件，不过用户数据是我自己用java后端编写的，下面也有提供接口**

## 使用事项

**1.如果第一次打开应用出现地图加载错误或未加载的情况，重新打开app即可（原因就是权限请求和地图加载撞一块了）**

**2.如果后台频繁切换，导致地图卡在了欢迎界面，重新打开app即可（我怀疑handler内存泄漏导致，但我自己完全没有遇到过这种情况)**

**3.APP内的附近搜索、自定义地图功能无法使用（可恶，附近搜索的那个UI界面是整个app最好看的，我竟然没写完）**

## 功能介绍

### 地图

##### 定位

**定位功能有两种，第一种是3s一次对用户位置的定位，第二种是地点搜索后的定位(具体在后面的搜索介绍）**

##### 绘制

**绘制主要是绘制点，用户可以选择长按地图界面获得touch位置的地址数据，会以标准地址和市区adCode的形式呈现**

###### 导航（含语音播报）

 **导航功能的实现完全依赖于高德SDK组件，我就添加了这样的功能：如果用户对当前地图绘制了点，进入导航界面会自动填充绘制点的位置（我前几天看到这个一条龙UI组件，然后就默默删了写了一半的导航功能）**

##### 搜索

**搜索功能的数据来源于高德地图poi数据，对用户搜索目标进行模糊匹配。**

###### 附近

**现在只实现了更新用户当前位置**

**本该是整个app最精彩的部分（**

**采用了第三方库和androidx的toolbar完成了整个UI界面**

**但是现在这个功能只完成了界面**



#### 用户数据

**当时申请了腾讯等大众第三方登录，但是身份证拍得太糊一个都没有过（×）**

**利用java和tomcat和腾讯云搭建的后端**

**API接口是http://http://129.211.72.73:8080/map  （最好使用post）**

**返回参数分别是code，msg和data，其中data包括了用户的四个信息：用户名、昵称、头像的服务器地址和背景的服务器地址**

**主要实现的功能如下**：

**1.用户登录 **

**/login post参数为userName和password **

**2.用户注册**

**/register post参数为userName和password**

**3.自定义昵称**

**/updateNick post参数为userName和nick**

**4.修改密码**

**/updatePassword post参数为userName和password**

**5.自定义头像**

**/avatar post参数为userName和avatar，其中avatar后面必须是bitmap的base64的二进制编码**

**图片会存放在服务器的一个文件夹中，但是因为时间问题我没有写api接口，但是服务器提供一个图片在线加载链接 **http://http://129.211.72.73:8080/images/background(avatar)

**如果是背景就是background，头像就是avatar**

**后面加上图片的名称就行了，图片的名称是用户名+时间戳的形式保存，且返回参数data中会有具体链接**

**服务器可以接受gif图片，但是重新下载下来将会是jpg图片并且短期保存在本地内存中**

**6.自定义背景**

**/background 其余如上**

**如果腾讯不因为我的身份证模糊而throw我，说不定我现在已经写完附近功能了（）**

**三天快速入门android开发后端（×），这里就感谢一下郭霖老师了**



### 频繁使用的技术

**1.异步调用和回调，app里面有很多异步调用和回到，比如okhttp通过handler异步改变用户数据，再比如fragment通过callback的方式通知activity隐藏navigation**

**2.自定义view和ui相关**

**3.后端链接数据库和服务器**

**4.性能优化（虽然只优化了一点）**



### 感悟

**这次考核，对生命周期的了解太熟悉了，自己重写fixFragment阻止Fragment重绘，高德SDK提供的控件都是独立的生命周期，需要手动销毁等**

**其次是对于异步的认识和andorid后端的了解**

**最后还是很开心参加这次考核**

**最后的最后附上，别人手机上跑出来的效果**

